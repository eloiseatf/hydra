import { RSC_PATHNAME } from '../constants.js';
export function parseJSON(json) {
    if (String(json).includes('__proto__'))
        return JSON.parse(json, noproto);
    return JSON.parse(json);
}
function noproto(k, v) {
    if (k !== '__proto__')
        return v;
}
export function parseState(url) {
    try {
        const { pathname, search } = url;
        const state = pathname === RSC_PATHNAME
            ? parseJSON(url.searchParams.get('state') ?? '{}')
            : { pathname, search };
        return Object.fromEntries(Object.entries(state).map(([key, value]) => [
            decodeURIComponent(key ?? ''),
            decodeURIComponent(value ?? ''),
        ]));
    }
    catch {
        // Do not throw to prevent unhandled errors
    }
}
